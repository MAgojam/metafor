<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light"><script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Aggregate Multiple Effect Sizes or Outcomes Within Studies — aggregate.escalc • metafor</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Aggregate Multiple Effect Sizes or Outcomes Within Studies — aggregate.escalc"><meta property="og:description" content="The function can be used to aggregate multiple effect sizes or outcomes belonging to the same study (or to the same level of some other clustering variable) into a single combined effect size or outcome. "><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@wviechtb"><meta name="twitter:site" content="@wviechtb"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)"><!-- preferably CSS --><link rel="stylesheet" href="../preferably.css"><link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)"><script src="../darkswitch.js"></script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metafor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.9-28</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/metafor-package.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/diagram.html">Diagram</a>
</li>
<li>
  <a href="https://www.jstatsoft.org/article/view/v036i03" class="external-link">JSS Article</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://twitter.com/wviechtb" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/metafor" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
        
        


      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate Multiple Effect Sizes or Outcomes Within Studies</h1>
    
    <div class="hidden name"><code>aggregate.escalc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function can be used to aggregate multiple effect sizes or outcomes belonging to the same study (or to the same level of some other clustering variable) into a single combined effect size or outcome. <script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for escalc</span></span>
<span><span class="fu">aggregate</span><span class="op">(</span><span class="va">x</span>, <span class="va">cluster</span>, <span class="va">time</span>, <span class="va">obs</span>, <span class="va">V</span>, struct<span class="op">=</span><span class="st">"CS"</span>, <span class="va">rho</span>, <span class="va">phi</span>,</span>
<span>          weighted<span class="op">=</span><span class="cn">TRUE</span>, checkpd<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">fun</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>          addk<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">subset</span>, <span class="va">select</span>, <span class="va">digits</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>an object of class <code>"escalc"</code>.</p></dd>

   <dt>cluster</dt>
<dd><p>vector to specify the clustering variable (e.g., study).</p></dd>

   <dt>time</dt>
<dd><p>optional vector to specify the time points (only relevant when <code>struct="CAR"</code>, <code>"CS+CAR"</code>, or <code>"CS*CAR"</code>).</p></dd>

   <dt>obs</dt>
<dd><p>optional vector to distinguish different observed effect sizes or outcomes measured at the same time point (only relevant when <code>struct="CS*CAR"</code>).</p></dd>

   <dt>V</dt>
<dd><p>optional argument to specify the variance-covariance matrix of the sampling errors. If not specified, argument <code>struct</code> is used to specify the variance-covariance structure.</p></dd>

   <dt>struct</dt>
<dd><p>character string to specify the variance-covariance structure of the sampling errors within the same cluster (either <code>"ID"</code>, <code>"CS"</code>, <code>"CAR"</code>, <code>"CS+CAR"</code>, or <code>"CS*CAR"</code>). See ‘Details’.</p></dd>

   <dt>rho</dt>
<dd><p>value of the correlation of the sampling errors within clusters (when <code>struct="CS"</code>, <code>"CS+CAR"</code>, or <code>"CS*CAR"</code>). Can also be a vector with the value of the correlation for each cluster.</p></dd>

   <dt>phi</dt>
<dd><p>value of the autocorrelation of the sampling errors within clusters (when <code>struct="CAR"</code>, <code>"CS+CAR"</code>, or <code>"CS*CAR"</code>). Can also be a vector with the value of the autocorrelation for each cluster.</p></dd>

   <dt>weighted</dt>
<dd><p>logical to specify whether estimates within clusters should be aggregated using inverse-variance weighting (the default is <code>TRUE</code>). If set to <code>FALSE</code>, unweighted averages are computed.</p></dd>

   <dt>checkpd</dt>
<dd><p>logical to specify whether to check that the variance-covariance matrices of the sampling errors within clusters are positive definite (the default is <code>TRUE</code>).</p></dd>

   <dt>fun</dt>
<dd><p>optional list with three functions for aggregating other variables besides the effect sizes or outcomes within clusters (for numeric/integer variables, for logicals, and for all other types, respectively).</p></dd>

   <dt>na.rm</dt>
<dd><p>logical to specify whether <code>NA</code> values should be removed before aggregating values within clusters. Can also be a vector with two logicals (the first pertaining to the effect sizes or outcomes, the second to all other variables).</p></dd>

   <dt>addk</dt>
<dd><p>logical to specify whether to add the cluster size as a new variable (called <code>ki</code>) to the dataset (the default is <code>FALSE</code>).</p></dd>

   <dt>subset</dt>
<dd><p>optional (logical or numeric) vector to specify the subset of rows to include when aggregating the effect sizes or outcomes.</p></dd>

   <dt>select</dt>
<dd><p>optional vector to specify the names of the variables to include in the aggregated dataset.</p></dd>

   <dt>digits</dt>
<dd><p>optional integer to specify the number of decimal places to which the printed results should be rounded (the default is to take the value from the object).</p></dd>

   <dt>...</dt>
<dd><p>other arguments.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>In many meta-analyses, multiple effect sizes or outcomes can be extracted from the same study. Ideally, such structures should be analyzed using an appropriate multilevel/multivariate model as can be fitted with the <code><a href="rma.mv.html">rma.mv</a></code> function. However, there may occasionally be reasons for aggregating multiple effect sizes or outcomes belonging to the same study (or to the same level of some other clustering variable) into a single combined effect size or outcome. The present function can be used for this purpose.</p>
<p>The input must be an object of class <code>"escalc"</code>. The error ‘<code>Error in match.fun(FUN): argument "FUN" is missing, with no default</code>’ indicates that a regular data frame was passed to the function, but this does not work. One can turn a regular data frame (containing the effect sizes or outcomes and the corresponding sampling variances) into an <code>"escalc"</code> object with the <code><a href="escalc.html">escalc</a></code> function. See the ‘Examples’ below for an illustration of this.</p>
<p>The <code>cluster</code> variable is used to specify which estimates/outcomes belong to the same study/cluster.</p>
<p>In the simplest case, the estimates/outcomes within clusters (or, to be precise, their sampling errors) are assumed to be independent. This is usually a safe assumption as long as each study participant (or whatever the study units are) only contributes data to a single estimate/outcome. For example, if a study provides effect size estimates for male and female subjects separately, then the sampling errors can usually be assumed to be independent. In this case, one can set <code>struct="ID"</code> and multiple estimates/outcomes within the same cluster are combined using standard inverse-variance weighting (i.e., using weighted least squares) under the assumption of independence.</p>
<p>In other cases, the estimates/outcomes within clusters cannot be assumed to be independent. For example, if multiple effect size estimates are computed for the same group of subjects (e.g., based on different scales to measure some construct of interest), then the estimates are likely to be correlated. If the actual correlation between the estimates is unknown, one can often still make an educated guess and set argument <code>rho</code> to this value, which is then assumed to be the same for all pairs of estimates within clusters when <code>struct="CS"</code> (for a compound symmetric structure). Multiple estimates/outcomes within the same cluster are then combined using inverse-variance weighting taking their correlation into consideration (i.e., using generalized least squares). One can also specify a different value of <code>rho</code> for each cluster by passing a vector (of the same length as the number of clusters) to this argument.</p>
<p>If multiple effect size estimates are computed for the same group of subjects at different time points, then it may be more sensible to assume that the correlation between estimates decreases as a function of the distance between the time points. If so, one can specify <code>struct="CAR"</code> (for a continuous-time autoregressive structure), set <code>phi</code> to the autocorrelation (for two estimates one time-unit apart), and use argument <code>time</code> to specify the actual time points corresponding to the estimates. The correlation between two estimates, <em></em>\(y_{it}\) and <em></em>\(y_{it'}\), in the <em></em>\(i\textrm{th}\) cluster, with time points <em></em>\(\textrm{time}_{it}\) and <em></em>\(\textrm{time}_{it'}\), is then given by <em></em>\(\phi^{|\textrm{time}_{it} - \textrm{time}_{it'}|}\). One can also specify a different value of <code>phi</code> for each cluster by passing a vector (of the same length as the number of clusters) to this argument.</p>
<p>One can also combine the compound symmetric and autoregressive structures if there are multiple time points and multiple observed effect sizes or outcomes at these time points. One option is <code>struct="CS+CAR"</code>. In this case, one must specify the <code>time</code> argument and both <code>rho</code> and <code>phi</code>. The correlation between two estimates, <em></em>\(y_{it}\) and <em></em>\(y_{it'}\), in the <em></em>\(i\textrm{th}\) cluster, with time points <em></em>\(\textrm{time}_{it}\) and <em></em>\(\textrm{time}_{it'}\), is then given by <em></em>\(\rho + (1 - \rho) \phi^{|\textrm{time}_{it} - \textrm{time}_{it'}|}\).</p>
<p>Alternatively, one can specify <code>struct="CS*CAR"</code>. In this case, one must specify both the <code>time</code> and <code>obs</code> arguments and both <code>rho</code> and <code>phi</code>. The correlation between two estimates, <em></em>\(y_{ijt}\) and <em></em>\(y_{ijt'}\), with the same value for <code>obs</code> but different values for <code>time</code>, is then given by <em></em>\(\phi^{|\textrm{time}_{ijt} - \textrm{time}_{ijt'}|}\), the correlation between two estimates, <em></em>\(y_{ijt}\) and <em></em>\(y_{ij't}\), with different values for <code>obs</code> but the same value for <code>time</code>, is then given by <em></em>\(\rho\), and the correlation between two estimates, <em></em>\(y_{ijt}\) and <em></em>\(y_{ij't'}\), with different values for <code>obs</code> and different values for <code>time</code>, is then given by <em></em>\(\rho \times \phi^{|\textrm{time}_{ijt} - \textrm{time}_{ijt'}|}\).</p>
<p>Finally, if one actually knows the correlation (and hence the covariance) between each pair of estimates (or has an approximation thereof), one can also specify the entire variance-covariance matrix of the estimates (or more precisely, their sampling errors) via the <code>V</code> argument (in this case, arguments <code>struct</code>, <code>time</code>, <code>obs</code>, <code>rho</code>, and <code>phi</code> are ignored). Note that the <code><a href="vcalc.html">vcalc</a></code> function can be used to construct such a <code>V</code> matrix and provides even more flexibility for specifying various types of dependencies. See the ‘Examples’ below for an illustration of this.</p>
<p>Instead of using inverse-variance weighting (i.e., weighted/generalized least squares) to combine the estimates within clusters, one can set <code>weighted=FALSE</code> in which case the estimates are averaged within clusters without any weighting (although the correlations between estimates as specified are still taken into consideration).</p>
<p>Other variables (besides the estimates) will also be aggregated to the cluster level. By default, numeric/integer type variables are averaged, logicals are also averaged (yielding the proportion of <code>TRUE</code> values), and for all other types of variables (e.g., character variables or factors) the most frequent category/level is returned. One can also specify a list of three functions via the <code>fun</code> argument for aggregating variables belonging to these three types.</p>
<p>Argument <code>na.rm</code> controls how missing values should be handled. By default, any missing estimates are first removed before aggregating the non-missing values within each cluster. The same applies when aggregating the other variables. One can also specify a vector with two logicals for the <code>na.rm</code> argument to control how missing values should be handled when aggregating the estimates and when aggregating all other variables.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>c("escalc","data.frame")</code> that contains the (selected) variables aggregated to the cluster level.</p>


<p>The object is formatted and printed with the <code><a href="print.escalc.html">print</a></code> function.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Wolfgang Viechtbauer <a href="mailto:wvb@metafor-project.org">wvb@metafor-project.org</a> <a href="https://www.metafor-project.org" class="external-link">https://www.metafor-project.org</a></p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Viechtbauer, W. (2010). Conducting meta-analyses in R with the metafor package. <em>Journal of Statistical Software</em>, <b>36</b>(3), 1–48. <a href="https://doi.org/10.18637/jss.v036.i03" class="external-link">https://doi.org/10.18637/jss.v036.i03</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="escalc.html">escalc</a></code> for a function to create <code>escalc</code> objects.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### copy data into 'dat' and examine data</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wviechtb.github.io/metadat/reference/dat.konstantopoulos2011.html" class="external-link">dat.konstantopoulos2011</a></span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">11</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    district school study year     yi    vi </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        11      1     1 1976 -0.180 0.118 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        11      2     2 1976 -0.220 0.118 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        11      3     3 1976  0.230 0.144 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        11      4     4 1976 -0.300 0.144 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        12      1     5 1989  0.130 0.014 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        12      2     6 1989 -0.260 0.014 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        12      3     7 1989  0.190 0.015 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        12      4     8 1989  0.320 0.024 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        18      1     9 1994  0.450 0.023 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       18      2    10 1994  0.380 0.043 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       18      3    11 1994  0.290 0.012 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### aggregate estimates to the district level, assuming independent sampling</span></span></span>
<span class="r-in"><span><span class="co">### errors for multiples studies/schools within the same district</span></span></span>
<span class="r-in"><span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu">aggregate</span><span class="op">(</span><span class="va">dat</span>, cluster<span class="op">=</span><span class="va">district</span>, struct<span class="op">=</span><span class="st">"ID"</span>, addk<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    district school study   year     yi    vi ki </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        11    2.5   2.5 1976.0 -0.126 0.032  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        12    2.5   6.5 1989.0  0.067 0.004  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        18    2.0  10.0 1994.0  0.350 0.007  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        27    2.5  13.5 1976.0  0.500 0.001  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        56    2.5  17.5 1997.0  0.051 0.002  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        58    6.0  25.0 1976.0 -0.042 0.001 11 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        71    2.0  32.0 1997.0  0.886 0.004  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        86    4.5  37.5 1997.0 -0.029 0.000  8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        91    3.5  44.5 2000.0  0.250 0.002  6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10      108    3.0  50.0 2000.0  0.015 0.006  5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11      644    2.5  54.5 1994.5  0.162 0.019  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### copy data into 'dat' and examine data</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wviechtb.github.io/metadat/reference/dat.assink2016.html" class="external-link">dat.assink2016</a></span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">19</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    study esid id      yi     vi pubstatus year deltype</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1    1  1  0.9066 0.0740         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      1    2  2  0.4295 0.0398         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      1    3  3  0.2679 0.0481         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      1    4  4  0.2078 0.0239         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      1    5  5  0.0526 0.0331         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      1    6  6 -0.0507 0.0886         1  4.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      2    1  7  0.5117 0.0115         1  1.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      2    2  8  0.4738 0.0076         1  1.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9      2    3  9  0.3544 0.0065         1  1.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10     3    1 10  2.2844 0.3325         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11     3    2 11  2.1771 0.3073         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12     3    3 12  1.7777 0.2697         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13     3    4 13  1.5480 0.4533         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14     3    5 14  1.4855 0.1167         1 -6.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15     3    6 15  1.4836 0.1706         1 -6.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16     3    7 16  1.2777 0.1538         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17     3    8 17  1.0311 0.3132         1 -8.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18     3    9 18  0.9409 0.1487         1 -6.5 general</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19     3   10 19  0.6263 0.2139         1 -6.5 general</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### note: 'dat' is a regular data frame</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "data.frame"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### turn data frame into an 'escalc' object</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="escalc.html">escalc</a></span><span class="op">(</span>yi<span class="op">=</span><span class="va">yi</span>, vi<span class="op">=</span><span class="va">vi</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "escalc"     "data.frame"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### aggregate the estimates to the study level, assuming a CS structure for</span></span></span>
<span class="r-in"><span><span class="co">### the sampling errors within studies with a correlation of 0.6</span></span></span>
<span class="r-in"><span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu">aggregate</span><span class="op">(</span><span class="va">dat</span>, cluster<span class="op">=</span><span class="va">study</span>, rho<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    study esid   id      yi     vi pubstatus  year deltype </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1  3.5  3.5  0.1629 0.0197         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      2  2.0  8.0  0.4060 0.0056         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      3  5.5 14.5  1.0790 0.0832         1  -7.7 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      4  1.0 20.0 -0.0447 0.0331         1  -7.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      5  1.0 21.0  1.5490 0.1384         1 -11.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      6  3.0 24.0 -0.0550 0.0214         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      7  3.5 29.5  1.0072 0.0545         1   3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      8  1.0 33.0  0.3695 0.0199         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9      9  1.5 34.5  0.1379 0.0271         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    10  3.0 38.0  0.1167 0.0107         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    11 11.5 51.5  0.5258 0.0114         0  -6.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    12  3.0 65.0  0.2805 0.0028         0   4.5   overt </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    13  1.5 68.5  0.3018 0.0110         1  -3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    14  3.5 72.5  0.0356 0.0014         1  -1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    15  2.0 77.0  0.0908 0.1269         1 -13.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    16  8.5 86.5  0.0181 0.0169         1   2.5  covert </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    17  3.5 97.5 -0.0552 0.0072         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### use vcalc() and then the V argument</span></span></span>
<span class="r-in"><span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="vcalc.html">vcalc</a></span><span class="op">(</span><span class="va">vi</span>, cluster<span class="op">=</span><span class="va">study</span>, obs<span class="op">=</span><span class="va">esid</span>, data<span class="op">=</span><span class="va">dat</span>, rho<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu">aggregate</span><span class="op">(</span><span class="va">dat</span>, cluster<span class="op">=</span><span class="va">study</span>, V<span class="op">=</span><span class="va">V</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    study esid   id      yi     vi pubstatus  year deltype </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1  3.5  3.5  0.1629 0.0197         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      2  2.0  8.0  0.4060 0.0056         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      3  5.5 14.5  1.0790 0.0832         1  -7.7 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      4  1.0 20.0 -0.0447 0.0331         1  -7.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      5  1.0 21.0  1.5490 0.1384         1 -11.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      6  3.0 24.0 -0.0550 0.0214         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      7  3.5 29.5  1.0072 0.0545         1   3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      8  1.0 33.0  0.3695 0.0199         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9      9  1.5 34.5  0.1379 0.0271         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    10  3.0 38.0  0.1167 0.0107         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    11 11.5 51.5  0.5258 0.0114         0  -6.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    12  3.0 65.0  0.2805 0.0028         0   4.5   overt </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    13  1.5 68.5  0.3018 0.0110         1  -3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    14  3.5 72.5  0.0356 0.0014         1  -1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    15  2.0 77.0  0.0908 0.1269         1 -13.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    16  8.5 86.5  0.0181 0.0169         1   2.5  covert </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    17  3.5 97.5 -0.0552 0.0072         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### use a correlation of 0.7 for effect sizes corresponding to the same type of</span></span></span>
<span class="r-in"><span><span class="co">### delinquent behavior and a correlation of 0.5 for effect sizes corresponding</span></span></span>
<span class="r-in"><span><span class="co">### to different types of delinquent behavior</span></span></span>
<span class="r-in"><span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="vcalc.html">vcalc</a></span><span class="op">(</span><span class="va">vi</span>, cluster<span class="op">=</span><span class="va">study</span>, type<span class="op">=</span><span class="va">deltype</span>, obs<span class="op">=</span><span class="va">esid</span>, data<span class="op">=</span><span class="va">dat</span>, rho<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu">aggregate</span><span class="op">(</span><span class="va">dat</span>, cluster<span class="op">=</span><span class="va">study</span>, V<span class="op">=</span><span class="va">V</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    study esid   id      yi     vi pubstatus  year deltype </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1  3.5  3.5  0.1275 0.0190         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      2  2.0  8.0  0.3922 0.0059         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      3  5.5 14.5  0.9909 0.0783         1  -7.7 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      4  1.0 20.0 -0.0447 0.0331         1  -7.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      5  1.0 21.0  1.5490 0.1384         1 -11.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      6  3.0 24.0 -0.0838 0.0193         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      7  3.5 29.5  1.0821 0.0573         1   3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      8  1.0 33.0  0.3695 0.0199         1   1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9      9  1.5 34.5  0.1372 0.0287         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    10  3.0 38.0  0.1025 0.0102         1   4.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    11 11.5 51.5  0.4522 0.0093         0  -6.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    12  3.0 65.0  0.2840 0.0028         0   4.5   overt </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    13  1.5 68.5  0.3016 0.0117         1  -3.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    14  3.5 72.5  0.0334 0.0012         1  -1.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    15  2.0 77.0  0.0827 0.1359         1 -13.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    16  8.5 86.5 -0.2268 0.0176         1   2.5  covert </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    17  3.5 97.5 -0.0914 0.0071         1   5.5 general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### reshape 'dat.ishak2007' into long format</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wviechtb.github.io/metadat/reference/dat.ishak2007.html" class="external-link">dat.ishak2007</a></span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="fu"><a href="https://wviechtb.github.io/metadat/reference/dat.ishak2007.html" class="external-link">dat.ishak2007</a></span>, direction<span class="op">=</span><span class="st">"long"</span>, idvar<span class="op">=</span><span class="st">"study"</span>, v.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yi"</span>,<span class="st">"vi"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               varying<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">study</span>, <span class="va">time</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">yi</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               study mdur mbase time    yi    vi </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    Alegret (2001) 16.1  53.6    1 -33.4  14.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Barichella (2003) 13.5  45.3    1 -20.0   7.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Barichella (2003) 13.5  45.3    3 -30.0   5.7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     Berney (2002) 13.6  45.6    1 -21.1   7.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   Burchiel (1999) 13.6  48.0    1 -20.0   8.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   Burchiel (1999) 13.6  48.0    2 -20.0   8.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   Burchiel (1999) 13.6  48.0    3 -18.0   5.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       Chen (2003) 12.1  65.7    2 -32.9 125.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### aggregate the estimates to the study level, assuming a CAR structure for</span></span></span>
<span class="r-in"><span><span class="co">### the sampling errors within studies with an autocorrelation of 0.9</span></span></span>
<span class="r-in"><span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu">aggregate</span><span class="op">(</span><span class="va">dat</span>, cluster<span class="op">=</span><span class="va">study</span>, struct<span class="op">=</span><span class="st">"CAR"</span>, time<span class="op">=</span><span class="va">time</span>, phi<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">agg</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               study mdur mbase time    yi    vi </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    Alegret (2001) 16.1  53.6    1 -33.4  14.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Barichella (2003) 13.5  45.3    2 -28.1   5.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     Berney (2002) 13.6  45.6    1 -21.1   7.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   Burchiel (1999) 13.6  48.0    2 -17.2   4.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       Chen (2003) 12.1  65.7    2 -32.9 125.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Wolfgang Viechtbauer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    appId: 'SFWCWKDGL8',
    
    apiKey: 'b56f56470243cf9799f796a3d6ecaedd',
    indexName: 'metafor',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

